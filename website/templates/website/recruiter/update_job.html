{% extends 'website/base.html' %}
{% load static %}

{% block title %}Update Job - HA Solutions{% endblock %}


{% block content %}
<div class="container" style="max-width: 900px; margin: 40px auto; padding: 0 20px;">
    <div style="margin-bottom: 30px;">
        <a href="{% url 'recruiter_dashboard' %}" style="color: var(--primary-color); text-decoration: none;">‚Üê Back to Dashboard</a>
        <h1 style="margin-top: 20px; color: var(--text-dark);">Update Job: {{ job.title }}</h1>
        <p style="color: var(--text-light); margin-top: 5px;">Job Number: {{ job.job_number }}</p>
    </div>
    
    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }}" style="margin-bottom: 20px;">
                {{ message }}
            </div>
        {% endfor %}
    {% endif %}
    
    <div style="background: var(--card-bg); border-radius: 10px; padding: 40px; box-shadow: var(--shadow-sm);">
        <form method="post">
            {% csrf_token %}
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                <div class="form-group">
                    <label for="{{ form.title.id_for_label }}" style="display: block; margin-bottom: 8px; color: var(--text-dark); font-weight: 500;">Job Title <span style="color: #dc3545;">*</span></label>
                    {{ form.title }}
                    {% if form.title.errors %}
                        <div style="color: #dc3545; font-size: 14px; margin-top: 5px;">{{ form.title.errors }}</div>
                    {% endif %}
                </div>
                
                <div class="form-group">
                    <label for="{{ form.category.id_for_label }}" style="display: block; margin-bottom: 8px; color: var(--text-dark); font-weight: 500;">Category <span style="color: #dc3545;">*</span></label>
                    {{ form.category }}
                    {% if form.category.errors %}
                        <div style="color: #dc3545; font-size: 14px; margin-top: 5px;">{{ form.category.errors }}</div>
                    {% endif %}
                </div>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                <div class="form-group">
                    <label for="{{ form.location.id_for_label }}" style="display: block; margin-bottom: 8px; color: var(--text-dark); font-weight: 500;">Location <span style="color: #dc3545;">*</span></label>
                    {{ form.location }}
                    {% if form.location.errors %}
                        <div style="color: #dc3545; font-size: 14px; margin-top: 5px;">{{ form.location.errors }}</div>
                    {% endif %}
                </div>
                
                <div class="form-group">
                    <label for="{{ form.state.id_for_label }}" style="display: block; margin-bottom: 8px; color: var(--text-dark); font-weight: 500;">State</label>
                    {{ form.state }}
                    {% if form.state.errors %}
                        <div style="color: #dc3545; font-size: 14px; margin-top: 5px;">{{ form.state.errors }}</div>
                    {% endif %}
                </div>
                
                <div class="form-group">
                    <label for="{{ form.city.id_for_label }}" style="display: block; margin-bottom: 8px; color: var(--text-dark); font-weight: 500;">City</label>
                    {{ form.city }}
                    {% if form.city.errors %}
                        <div style="color: #dc3545; font-size: 14px; margin-top: 5px;">{{ form.city.errors }}</div>
                    {% endif %}
                </div>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                <div class="form-group">
                    <label for="{{ form.type.id_for_label }}" style="display: block; margin-bottom: 8px; color: var(--text-dark); font-weight: 500;">Job Type <span style="color: #dc3545;">*</span></label>
                    {{ form.type }}
                    {% if form.type.errors %}
                        <div style="color: #dc3545; font-size: 14px; margin-top: 5px;">{{ form.type.errors }}</div>
                    {% endif %}
                </div>
                
                <div class="form-group">
                    <label for="{{ form.date.id_for_label }}" style="display: block; margin-bottom: 8px; color: var(--text-dark); font-weight: 500;">Date <span style="color: #dc3545;">*</span></label>
                    {{ form.date }}
                    {% if form.date.errors %}
                        <div style="color: #dc3545; font-size: 14px; margin-top: 5px;">{{ form.date.errors }}</div>
                    {% endif %}
                </div>
            </div>
            
            <div class="form-group" style="margin-bottom: 30px;">
                <label for="{{ form.detailed_description.id_for_label }}" style="display: block; margin-bottom: 8px; color: var(--text-dark); font-weight: 500;">Job Description <span style="color: #dc3545;">*</span></label>
                <small style="color: var(--text-light); display: block; margin-bottom: 8px;">Enter the complete job description. A condensed version will automatically appear on the careers listing page.</small>
                <div id="editor-container"></div>
                <div style="display: none;">
                    {{ form.detailed_description }}
                </div>
                {% if form.detailed_description.errors %}
                    <div style="color: #dc3545; font-size: 14px; margin-top: 5px;">{{ form.detailed_description.errors }}</div>
                {% endif %}
            </div>
            
            <div class="form-group" style="margin-bottom: 30px;">
                <label style="display: flex; align-items: center; gap: 10px; color: var(--text-dark); font-weight: 500;">
                    {{ form.is_active }}
                    <span>Active (show on careers page)</span>
                </label>
            </div>
            
            <div style="display: flex; gap: 10px;">
                <button type="submit" class="btn btn-primary">Update Job</button>
                <a href="{% url 'recruiter_dashboard' %}" class="btn" style="background: #6c757d; color: white; text-decoration: none; padding: 12px 24px; border-radius: 5px;">Cancel</a>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
<style>
    #editor-container {
        height: 400px;
        margin-bottom: 20px;
    }
    .ql-editor {
        min-height: 400px;
        font-size: 16px;
    }
    .hidden {
        display: none;
    }
</style>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        var quill = new Quill('#editor-container', {
            theme: 'snow',
            modules: {
                toolbar: [
                    [{ 'header': [1, 2, 3, false] }],
                    ['bold', 'italic', 'underline', 'strike'],
                    [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                    [{ 'align': [] }],
                    [{ 'color': [] }, { 'background': [] }],
                    ['link'],
                    ['clean']
                ]
            },
            placeholder: 'Enter the complete job description...'
        });
        
        // Get the textarea
        var textarea = document.getElementById('{{ form.detailed_description.id_for_label }}');
        
        // Set initial content if textarea has value
        if (textarea.value) {
            // Clean up the HTML - ensure proper paragraph structure
            var htmlContent = textarea.value;
            // If content doesn't have proper paragraph tags, wrap it
            if (!htmlContent.trim().startsWith('<')) {
                // Plain text - convert line breaks to paragraphs
                var lines = htmlContent.split(/\n\s*\n/);
                htmlContent = lines.map(function(line) {
                    return '<p>' + line.trim().replace(/\n/g, '<br>') + '</p>';
                }).join('');
            }
            quill.root.innerHTML = htmlContent;
        }
        
        // Update textarea on text change
        quill.on('text-change', function() {
            textarea.value = quill.root.innerHTML;
        });
        
        // Also update on form submit to ensure we have the latest content
        var form = textarea.closest('form');
        if (form) {
            form.addEventListener('submit', function(e) {
                // Force update before submit
                textarea.value = quill.root.innerHTML;
            });
        }
    });
</script>
{% endblock %}

